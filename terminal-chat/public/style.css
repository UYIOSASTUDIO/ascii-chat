/* --- MODERN TERMINAL THEME --- */
@import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap');

:root {
    /* Modernes Farbschema */
    --bg-color: #1a1a1a;           /* Elegantes Anthrazit */
    --panel-bg: #222222;           /* Etwas helleres Grau für Sidebars */
    --text-main: #e0e0e0;          /* Fast Weiß für Text */
    --text-muted: #888888;         /* Grau für Infos */
    --accent-color: #4af626;       /* Dein Grün */
    --accent-dim: rgba(74, 246, 38, 0.15);

    /* Rahmen */
    --border-color: rgba(255, 255, 255, 0.25);
    --border-thick: 1px solid var(--border-color);

    --font-stack: 'Fira Code', 'Courier New', monospace;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    scrollbar-width: thin;
    scrollbar-color: #444 var(--bg-color);
}

html, body {
    height: 100%;
    width: 100%;
    background-color: var(--bg-color);
    color: var(--text-main);
    font-family: var(--font-stack);
    font-size: 14px;
    display: flex;
    flex-direction: column;
    overflow: hidden; /* WICHTIG: Kein Scrollen am Hauptfenster */
}

/* --- HEADER --- */
/* --- HEADER (Tactical Dashboard Style) --- */

header {
    display: flex;
    justify-content: space-between;
    align-items: center;

    /* WICHTIG: FESTE HÖHE ERZWINGEN */
    height: 30px;
    min-height: 30px;  /* Doppelte Sicherheit */
    flex-shrink: 0;    /* VERBIETET das Schrumpfen, egal wie voll der Chat ist */

    padding: 0 5px;
    background-color: rgba(10, 10, 10, 0.95);
    border-bottom: 1px solid #333;
    position: relative;
    z-index: 100;
    user-select: none;
}

/* DAS LOGO (Links) */
.logo {
    font-family: 'Courier New', monospace; /* Hacker Font */
    font-weight: bold;
    font-size: 1.2em;
    color: var(--accent-color);
    text-shadow: 0 0 5px rgba(0, 255, 0, 0.4); /* Leichter Glow */
    letter-spacing: 1px;
}

/* STATUS BEREICH (Rechts) */
.status-bar {
    display: flex;
    align-items: center;
    gap: 20px; /* Abstand zwischen Timer, ID und Avatar */
    font-family: monospace;
    font-size: 0.9em;
}

/* Der Timer */
#session-timer {
    color: #888;
}

/* Die User ID */
#current-user-id {
    color: var(--accent-color);
    font-weight: bold;
    border: 1px solid #333;
    padding: 2px 6px;
    border-radius: 4px;
    background: rgba(0,0,0,0.3);
}

/* Der Avatar / Settings Button */
#current-user-avatar {
    width: 32px;
    height: 32px;
    background-color: var(--accent-color);
    color: #000; /* Schwarzer Text auf grünem Grund */
    font-weight: bold;

    display: flex;
    align-items: center;
    justify-content: center;

    border-radius: 4px; /* Eckig für technischen Look, oder 50% für Kreis */
    cursor: pointer;
    transition: all 0.2s;
}

#current-user-avatar:hover {
    transform: scale(1.1);
    box-shadow: 0 0 10px var(--accent-color);
}

/* ==========================================================================
   MAIN LAYOUT (FLEXBOX statt GRID für Resizing)
   ========================================================================== */
.main-grid {
    display: flex;          /* Flexbox aktiviert */
    flex-direction: row;    /* Elemente nebeneinander */
    flex-grow: 1;           /* Füllt den Rest des Bildschirms unter dem Header */
    width: 100%;
    overflow: hidden;       /* Verhindert Scrollbars am Container */
}

/* --- LINKE SPALTE (SIDEBAR) --- */
.sidebar-col {
    /* Flex Eigenschaften für Resizing */
    width: 260px;           /* Startbreite */
    min-width: 180px;       /* Nicht schmaler als das */
    max-width: 500px;       /* Nicht breiter als das */
    flex-shrink: 0;         /* Darf nicht automatisch kleiner werden */

    display: flex;
    flex-direction: column;
    border-right: var(--border-thick) !important;
    background-color: var(--panel-bg);
    overflow: hidden;
    z-index: 10;
}

/* --- MITTLERE SPALTE (TERMINAL) --- */
.terminal-col {
    /* Nimmt den gesamten verfügbaren Rest-Platz */
    flex-grow: 1;
    min-width: 400px;       /* Damit der Chat nicht komplett zerdrückt wird */

    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
    overflow: hidden;
    background-color: var(--panel-bg);
    z-index: 1;
}

/* --- RECHTE SPALTE (PANELS) --- */
.side-col {
    /* Flex Eigenschaften für Resizing */
    width: 320px;           /* Startbreite (etwas breiter als links) */
    min-width: 200px;
    max-width: 600px;
    flex-shrink: 0;
    border-left: var(--border-thick);

    display: flex;
    justify-content: space-around; /* Flexbox für vertikale Aufteilung (Promo / Voice) */
    flex-direction: column;
    height: 100%;
    border-right: var(--border-thick);
    position: relative;
    z-index: 10; /* Liegt jetzt unter dem Resizer (z-index 100), aber Border ist im Box-Model */
    background-color: var(--panel-bg);
    overflow: hidden;
}

/* --- RESIZER (GRIFFE) FIXED --- */

.resizer {
    /* GRÖSSE & POSITION */
    width: 6px;              /* Etwas breiter, damit man ihn leichter trifft */
    flex-shrink: 0;          /* WICHTIG: Verhindert, dass Flexbox ihn auf 0px quetscht */

    /* LAYERING - DAS IST DER FIX */
    position: relative;
    z-index: 2147483647 !important; /* Maximal möglicher Z-Index Wert im Browser */

    /* ZENTRIERUNG ÜBER DER LINIE */
    margin-left: -3px;       /* Die Hälfte der Breite negativ, um genau auf der Kante zu sitzen */
    margin-right: -3px;

    /* OPTIK & CURSOR */
    cursor: col-resize;
    background-color: transparent;
    transition: background-color 0.1s;
}

/* Hover-Status (Grün) */
.resizer:hover, .resizer.resizing {
    background-color: var(--accent-color);
}

/* Horizontaler Resizer (Rechte Spalte) */
.resizer-horizontal {
    height: 6px;             /* Auch hier etwas dicker */
    flex-shrink: 0;

    position: relative;
    z-index: 2147483647 !important; /* Auch hier nach ganz vorne */

    margin-top: -3px;        /* Zentrieren */
    margin-bottom: -3px;

    cursor: row-resize;
    background-color: transparent;

    /* Die feine Linie im Hintergrund (optional, hilft bei Orientierung) */
    border-top: 1px solid rgba(255,255,255,0.05);
}

.resizer-horizontal:hover {
    background-color: var(--accent-color);
}

/* ==========================================================================
   CONTENT STYLES (Design bleibt gleich)
   ========================================================================== */

#chat-list {
    flex: 1;
    overflow-y: auto;
    padding: 10px 0;
}

.chat-item {
    padding: 10px 20px;
    cursor: pointer;
    color: var(--text-muted);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 3px solid transparent;
    transition: all 0.2s;
}

.chat-item:hover {
    background-color: rgba(255, 255, 255, 0.03);
    color: var(--text-main);
}

.chat-item.active {
    background-color: var(--accent-dim);
    color: var(--accent-color);
    border-left: 3px solid var(--accent-color);
    font-weight: bold;
}

.unread-badge {
    background: var(--accent-color);
    color: #000;
    padding: 2px 6px;
    font-size: 0.75em;
    border-radius: 4px;
    font-weight: bold;
    display: none;
}
.unread-badge.visible { display: inline-block; }

/* Voice Panel unten rechts */
/* WICHTIG: Das untere Panel muss flexibel sein für den Resizer */
#info-window {
    flex-shrink: 0; /* Feste Höhe, aber änderbar via JS */
    min-height: 150px;
    display: flex;
    flex-direction: column;
}

#voice-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    text-align: center;
    padding: 10px;
}

#voice-status {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 20px;
    width: 100%;
    text-align: center;
    font-weight: bold;
    letter-spacing: 1px;
}

#voice-status.active { color: #4af626; text-shadow: 0 0 5px rgba(74, 246, 38, 0.5); }
#voice-status.alert { color: #ff3333; animation: blink 1s infinite; }

.voice-visualizer {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    height: 60px;
    gap: 4px;
    margin-bottom: 20px;
    width: calc(100% - 30px);
    margin-left: 15px;
    margin-right: 15px;
    opacity: 0.2;
    transition: opacity 0.3s;
}

.voice-visualizer.active { opacity: 1; }

.bar {
    flex: 1;
    background-color: #4af626;
    height: 3px;
    transition: height 0.05s ease;
    max-width: 15px;
}

#voice-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    width: 100%;
}

/* TERMINAL OUTPUT */
#output {
    flex: 1;
    overflow-y: auto;
    padding: 25px;
    padding-bottom: 10px;
    font-size: 1.05em;
    line-height: 1.6;
}

.line { margin-bottom: 6px; word-wrap: break-word; }
.system-msg { color: var(--text-muted); }
.error-msg { color: #ff5555; }
.my-msg { color: #fff; }
.partner-msg { color: #ccc; }
.dynamic-name { font-weight: bold; color: var(--accent-color); cursor: pointer; }

/* ==========================================================================
   MODERN GLASS INPUT AREA (Floating & Matching User-Panel)
   ========================================================================== */

.input-area {
    /* 1. MATCHING STYLE (Identisch zum User-Panel) */
    background: rgba(20, 20, 20, 0.6);

    /* Blur Effekt */
    -webkit-backdrop-filter: blur(12px) saturate(180%);
    backdrop-filter: blur(12px) saturate(180%);

    /* Subtiler Verlauf */
    background-image: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.05) 0%,
            rgba(255, 255, 255, 0.01) 100%
    );

    /* 2. FLOATING & SHAPE (Schweben & Rundungen) */
    /* Wir entfernen die durchgehende Border-Top und machen einen Rahmen rundherum */
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-top: 1px solid rgba(255, 255, 255, 0.12); /* Lichtkante oben */
    border-radius: 14px; /* Identisch zum User-Panel */

    /* Das Schweben: Abstand zu den Rändern */
    margin: 0 10px 10px 10px; /* Links/Rechts Luft, Unten Abstand zum Rand */

    /* 3. TIEFE (Schatten) */
    box-shadow:
            0 4px 20px rgba(0, 0, 0, 0.4), /* Weicher Schatten */
            inset 0 0 0 1px rgba(255, 255, 255, 0.02); /* Inneres Glühen */

    /* 4. LAYOUT */
    display: flex;
    align-items: flex-end; /* Wächst nach oben */
    padding: 15px 20px;    /* Innenabstand */
    min-height: 60px;
    flex-shrink: 0;
    position: relative;    /* Wichtig für Autocomplete Position */
    z-index: 50;
}

/* Der Wrapper für Prompt und Input */
.input-wrapper {
    position: relative;
    flex-grow: 1;
    display: flex;
    align-items: flex-start;
    width: 100%;
    min-width: 0;
}

#prompt {
    color: var(--accent-color);
    margin-right: 12px;
    font-weight: 700;
    font-size: 1.1em;
    user-select: none;
    flex-shrink: 0;
    padding-top: 2px; /* Ausrichtung */
    text-shadow: 0 0 8px var(--accent-dim);
}

.input-container {
    flex-grow: 1;
    display: grid;
    position: relative;
    width: 100%;
    min-width: 0;
}

#command-input, #cmd-mirror {
    grid-area: 1 / 1;
    width: 100%;

    font-family: 'Fira Code', monospace;
    font-size: 1.1em;
    line-height: 1.6;
    letter-spacing: 0.5px;

    padding: 0;
    margin: 0;
    border: none;
    background: transparent;

    /* FIX: AGGRESSIVES UMBRECHEN */
    white-space: pre-wrap;       /* Erhält Leerzeichen, erzwingt Umbruch am Rand */
    overflow-wrap: break-word;   /* Bricht lange Wörter um, wenn nötig */
    word-break: break-word;      /* Webkit-Support für besseres Umbrechen */

    /* Platz für Scrollbar reservieren, damit Text nicht springt */
    padding-right: 10px;
    max-height: 200px;
}

#command-input {
    z-index: 2;
    color: transparent;
    caret-color: transparent;
    outline: none;
    resize: none;
    overflow-y: auto;
}
#command-input::-webkit-scrollbar { width: 4px; }
#command-input::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }

#cmd-mirror {
    z-index: 1;
    color: #e0e0e0;
    pointer-events: none;
    min-height: 1.6em;
}

#command-input::placeholder {
    opacity: 0.3;
    color: #aaa;
}

.cursor-block {
    display: inline;
    background-color: var(--accent-color);
    color: #000;
    white-space: pre-wrap;
    animation: blink 1s step-end infinite;
    box-decoration-break: clone;
    -webkit-box-decoration-break: clone;
    border-radius: 1px;
    box-shadow: 0 0 5px var(--accent-color);
}

/* ==========================================================================
   MODERN AUTOCOMPLETE (Floating aligned to Input)
   ========================================================================== */

.autocomplete-items {
    position: absolute;
    bottom: 100%;
    /* Da .input-area jetzt schwebt, richten wir das Popup bündig dazu aus */
    left: 0;
    right: 0;
    margin-bottom: 10px; /* Kleiner Abstand zwischen Input-Bar und Popup */

    /* GLASS LOOK (Identisch) */
    background: rgba(25, 25, 25, 0.85);
    -webkit-backdrop-filter: blur(20px);
    backdrop-filter: blur(20px);

    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 14px; /* Gleicher Radius wie Input */

    box-shadow:
            0 10px 40px rgba(0, 0, 0, 0.6),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);

    z-index: 9999;
    max-height: 350px;
    overflow-y: auto;
    display: none;

    transform-origin: bottom center;
    animation: popupFadeIn 0.2s cubic-bezier(0.19, 1, 0.22, 1);
}

.autocomplete-items::-webkit-scrollbar { width: 6px; }
.autocomplete-items::-webkit-scrollbar-track { background: transparent; margin: 5px; }
.autocomplete-items::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 3px; }

.autocomplete-items div {
    padding: 12px 20px;
    cursor: pointer;
    background-color: transparent;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: #ccc;
    font-family: 'Fira Code', monospace;
    font-size: 0.95em;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.15s ease;
}
.autocomplete-items div:last-child { border-bottom: none; }

.autocomplete-items div:hover,
.autocomplete-active {
    background-color: rgba(255, 255, 255, 0.08) !important;
    color: #fff !important;
    box-shadow: inset 2px 0 0 var(--accent-color);
    padding-left: 24px;
}

.cmd-desc {
    color: #666; font-size: 0.8em; font-family: sans-serif;
    background: rgba(0,0,0,0.2); padding: 2px 6px; border-radius: 4px;
}
.autocomplete-active .cmd-desc { color: #aaa; background: rgba(0,0,0,0.4); }

@keyframes popupFadeIn {
    from { opacity: 0; transform: translateY(10px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

/* PANELS */
.panel-window {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border-bottom: var(--border-thick);
}
/* Das obere Panel muss flexibel sein, um den Platz zu füllen */
#panel-top {
    flex: 1;
    min-height: 100px; /* Mindesthöhe */
}

.panel-header {
    padding: 10px 15px;
    border-bottom: var(--border-thick);
    color: var(--text-muted);
    font-size: 0.8em;
    text-transform: uppercase;
    letter-spacing: 1px;
    background: var(--bg-color);
    flex-shrink: 0; /* Header darf nicht schrumpfen */
}

.panel-content, #promo-list {
    padding: 15px;
    overflow-y: auto;
    flex: 1;
}

/* Promo Cards */
.promo-card {
    border: 1px solid var(--border-color);
    padding: 12px;
    margin-bottom: 10px;
    background: rgba(255,255,255,0.02);
    transition: all 0.2s;
    cursor: pointer;
}
.promo-card:hover {
    border-color: var(--accent-color);
    background: rgba(74, 246, 38, 0.05);
}
.promo-title { font-weight: bold; color: var(--text-main); font-size: 1.1em; }
.promo-meta { font-size: 0.85em; color: var(--text-muted); margin-top: 4px; }
.promo-desc { color: var(--accent-color); font-size: 0.9em; margin: 8px 0; font-style: italic; opacity: 0.8; }

/* Buttons */
.voice-btn {
    background: transparent;
    border: 1px solid var(--border-color);
    color: var(--text-main);
    padding: 6px 12px;
    cursor: pointer;
    font-family: inherit; font-size: 0.9em;
    margin: 5px;
    border-radius: 4px;
    transition: all 0.2s;
}
.voice-btn:hover { border-color: var(--accent-color); color: var(--accent-color); }

/* Scrollbars */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-color); }
::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #666; }

/* ANIMATIONEN */
@keyframes blink {
    0%, 100% { background-color: var(--accent-color); color: #000; box-shadow: 0 0 5px var(--accent-dim); }
    50% { background-color: transparent; color: var(--text-main); box-shadow: none; }
}

/* DRAG & DROP OVERLAY */
#drop-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85); z-index: 100;
    display: none; justify-content: center; align-items: center;
    pointer-events: none;
}
#drop-overlay.active { display: flex; }
.drop-box {
    border: 2px dashed var(--accent-color);
    padding: 40px; color: var(--accent-color);
    font-size: 1.5em; background: rgba(0,0,0,0.8);
}

/* MOBILE */
@media (max-width: 900px) {
    .main-grid {
        flex-direction: column;
    }
    .sidebar-col, .side-col, .resizer, .resizer-horizontal {
        display: none;
    }
}

/* BLOG ITEMS */
.blog-entry-item {
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 12px 15px;
    margin-bottom: 8px;
    background: rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
}
.blog-entry-item:hover {
    border-color: var(--accent-color);
    background: rgba(74, 246, 38, 0.1);
    padding-left: 20px;
}
.blog-entry-item.important { border-color: #ff3333; color: #ffcccc; }
.blog-list-row { display: flex; width: 100%; align-items: center; }
.blog-list-icon { font-size: 1.2em; margin-right: 15px; }
.blog-list-title { flex-grow: 1; font-weight: bold; font-size: 1.1em; text-transform: uppercase; }
.blog-list-date { font-size: 0.8em; color: #666; font-family: monospace; }
.blog-title-large { font-size: 2em; color: var(--accent-color); margin: 10px 0 30px 0; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 15px; }
.blog-content.full-content { font-size: 1.1em; line-height: 1.8; color: var(--text-main); white-space: pre-wrap; }
.terminal-input { width: 100%; background: #111; border: 1px solid #444; color: var(--accent-color); padding: 10px; margin-bottom: 15px; font-family: inherit; font-size: 1em; }
.terminal-input:focus { border-color: var(--accent-color); outline: none; }
#unlock-pass { background: #000; border: 1px solid #ff3333; color: #ff3333; font-weight: bold; letter-spacing: 2px; }
#unlock-pass:focus { box-shadow: 0 0 10px rgba(255, 51, 51, 0.5); outline: none; }

/* SIDEBAR SEARCH */
.sidebar-search-wrapper { padding: 10px; border-bottom: 1px solid var(--border-color); background: rgba(0,0,0,0.2); }
#chat-search-input { width: 100%; background: transparent; border: 1px solid var(--border-color); color: var(--accent-color); font-family: inherit; font-size: 0.9em; padding: 5px 8px; outline: none; }
#chat-search-input:focus { border-color: var(--accent-color); background: rgba(74, 246, 38, 0.05); }

/* CHAT CATEGORIES */
.chat-category-header { padding: 15px 15px 5px 15px; font-size: 0.7em; color: #666; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid rgba(255,255,255,0.05); margin-bottom: 5px; }

/* STATE CLASSES */
.prompt-default { color: var(--accent-color) !important; opacity: 1; }
.prompt-error { color: #ff3333 !important; }
.prompt-warn { color: #ffff00 !important; }
.prompt-hidden { opacity: 0 !important; }
.input-locked { border-bottom: 1px solid #ff3333 !important; color: #ff3333 !important; pointer-events: none; }
.input-hidden { visibility: hidden; }
.promo-item { margin-bottom: 10px; border-bottom: 1px dashed #333; padding-bottom: 5px; cursor: pointer; transition: background 0.2s; }
.promo-item:hover { background: rgba(255, 255, 255, 0.05); }
.promo-name { color: #fff; font-weight: bold; }
.promo-desc { color: #888; font-size: 0.8em; margin-top: 2px; }
.promo-meta { color: #444; font-size: 0.7em; margin-top: 2px; }
.broadcast-box { border: 2px solid #f00; background: rgba(255, 0, 0, 0.1); padding: 15px; margin: 10px 0; }
.broadcast-title { color: #f00; font-weight: bold; font-size: 1.1em; margin-bottom: 8px; text-align: center; }
.broadcast-text { color: #fff; font-size: 1.1em; text-align: center; }
.broadcast-footer { text-align: right; font-size: 0.8em; color: #f00; margin-top: 10px; }
.group-broadcast-box { border: 2px solid #0f0; background: rgba(0, 255, 0, 0.1); padding: 10px; margin: 5px 0; }
.group-broadcast-header { color: #0f0; font-weight: bold; margin-bottom: 5px; }
.group-broadcast-text { color: #fff; font-style: italic; }
.group-broadcast-footer { text-align: right; font-size: 0.8em; color: #0f0; margin-top: 5px; }
.dynamic-name-admin { cursor: pointer; border-bottom: 1px dotted #555; }

.user-panel {
    /* 1. GLASS BASIS */
    /* Wir nutzen Schwarz mit Transparenz statt #111 */
    background: rgba(20, 20, 20, 0.6);

    /* 2. DER APPLE EFFEKT (Blur) */
    /* Das macht den Hintergrund unscharf ("Milchglas") */
    -webkit-backdrop-filter: blur(12px);
    backdrop-filter: blur(12px);

    /* 3. SUBTILER VERLAUF (Lichtreflexion) */
    /* Ein hauchzarter Verlauf von oben links (heller) nach unten rechts */
    background-image: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.05) 0%,
            rgba(255, 255, 255, 0.01) 100%
    );

    /* 4. RAHMEN & FORM */
    /* Apple nutzt keine dicken Borders. Nur feine "Hairlines" */
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-top: 1px solid rgba(255, 255, 255, 0.12); /* Oben etwas heller als Lichtkante */
    border-radius: 14px; /* Größere Radien wirken moderner/freundlicher */

    /* 5. LAYOUT & SPACING */
    display: flex;
    align-items: center;
    padding: 12px 16px; /* Mehr "Breathing Room" */

    /* Panel soll "schweben", nicht kleben */
    margin: 10px;

    /* 6. TIEFE (Shadow) */
    /* Weicher Schatten für das Schwebe-Gefühl */
    box-shadow:
            0 4px 20px rgba(0, 0, 0, 0.4), /* Großer weicher Schatten */
            inset 0 0 0 1px rgba(255, 255, 255, 0.02); /* Innerer Glanz */

    flex-shrink: 0;
    min-height: 60px; /* Etwas höher für bessere Proportionen */

    /* Animation für Interaktion */
    transition: all 0.3s ease;
}

/* Optional: Hover Effekt für das ganze Panel */
.user-panel:hover {
    background: rgba(30, 30, 30, 0.7);
    border-color: rgba(255, 255, 255, 0.15);
    transform: translateY(-1px); /* Minimales Anheben */
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
}

.user-avatar {
    width: 35px;
    height: 35px;
    background: var(--accent-color);
    color: #000;
    border-radius: 50%; /* Kreis */
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    font-size: 1.2em;
    margin-right: 10px;
}

.user-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center; /* WICHTIG: Vertikal zentrieren */
    gap: 2px; /* Kleiner Abstand zwischen Name und ID */
    overflow: hidden; /* Wichtig, falls der Name sehr lang ist */
    margin-right: 10px; /* Kleiner Abstand zum Zahnrad */
}

.user-name {
    font-weight: bold;
    color: var(--text-main);
    font-size: 1em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.1;
}

.user-id {
    font-size: 0.75em;
    color: var(--text-muted);
}

.session-timer {
    font-size: 0.65em;
    color: var(--accent-color);
    margin-top: 2px;
}

.user-settings-btn {
    cursor: pointer;
    font-size: 1.2em;
    opacity: 0.7;
    transition: opacity 0.2s;
    padding: 5px;
}
.user-settings-btn:hover { opacity: 1; transform: rotate(90deg); transition: 0.5s; }


/* --- SETTINGS MODAL --- */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(3px);
    z-index: 10000;
    display: none; /* Standardmäßig versteckt */
    justify-content: center;
    align-items: center;
}
.modal-overlay.open { display: flex; animation: fadeIn 0.2s; }

.modal-window {
    background: var(--panel-bg);
    border: 1px solid var(--accent-color);
    width: 450px;
    max-width: 90%;
    box-shadow: 0 0 20px rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
}

.modal-header {
    background: var(--bg-color);
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #333;
}
.modal-header h2 { font-size: 1.1em; color: var(--accent-color); margin: 0; }
.close-modal { background: none; border: none; color: #fff; font-size: 1.5em; cursor: pointer; }

.modal-content { padding: 20px; }

.setting-group { margin-bottom: 20px; }
.setting-group label { display: block; color: var(--text-muted); font-size: 0.8em; margin-bottom: 5px; letter-spacing: 1px;}

.readonly-field {
    background: #111; padding: 10px; color: #666; font-family: monospace; border: 1px solid #333;
    user-select: all;
}

.modal-input {
    width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 8px;
    font-family: inherit; font-size: 1em;
}
.modal-input:focus { border-color: var(--accent-color); outline: none; }

.sub-text { font-size: 0.7em; color: #555; margin-top: 3px; }

.role-badge {
    display: inline-block; padding: 5px 10px; background: #333; color: #fff; font-weight: bold; border-radius: 4px; font-size: 0.9em;
}

.modal-footer {
    display: flex; justify-content: space-between; align-items: center;
    margin-top: 10px; border-top: 1px solid #333; padding-top: 15px;
}
#login-time-display { font-size: 0.8em; color: #666; }

/* --- TOGGLE SWITCH (für Ghost Mode) --- */
.switch { position: relative; display: inline-block; width: 40px; height: 20px; vertical-align: middle; margin-left: 10px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; }
.slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; }
input:checked + .slider { background-color: var(--accent-color); }
input:checked + .slider:before { transform: translateX(20px); background-color: #000; }
.slider.round { border-radius: 20px; }
.slider.round:before { border-radius: 50%; }

.row-group { display: flex; justify-content: space-between; align-items: flex-end; }
.toggle-wrapper { display: flex; align-items: center; }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.system-uptime {
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
    color: var(--accent-color); /* Grün */
    letter-spacing: 1px;
    font-weight: bold;
    text-shadow: 0 0 5px rgba(74, 246, 38, 0.3);

    /* Damit man es beim Fenster-Ziehen nicht aus Versehen markiert */
    user-select: none;
    -webkit-app-region: no-drag;
}

/* Update für Mobile: Timer ausblenden wenn Platz eng wird */
@media (max-width: 700px) {
    .system-uptime { display: none; }
}

/* --- USER CONTEXT POPUP --- */
.user-popup {
    position: absolute;
    z-index: 9999;
    width: 280px;
    background-color: #181818;
    border: 1px solid var(--border-color);
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    border-radius: 6px;
    overflow: hidden;
    animation: fadeIn 0.1s ease-out;
}

.popup-header {
    background-color: var(--panel-bg);
    padding: 15px;
    display: flex;
    align-items: center;
    border-bottom: 1px solid #333;
}

.popup-avatar {
    width: 40px; height: 40px;
    background: var(--accent-color);
    color: #000;
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    font-weight: bold; font-size: 1.2em;
    margin-right: 12px;
}

.popup-title {
    flex-grow: 1;
    overflow: hidden;
}

.popup-name {
    font-weight: bold;
    color: #fff;
    font-size: 1.1em;
    margin-bottom: 2px;
}

.popup-id-row {
    display: flex;
    align-items: center;
    font-size: 0.8em;
    color: var(--text-muted);
}

.copy-icon {
    cursor: pointer;
    margin-left: 8px;
    transition: transform 0.2s;
}
.copy-icon:hover { color: #fff; transform: scale(1.2); }

.popup-body { padding: 15px; }

.popup-section { margin-bottom: 10px; }
.popup-section label {
    display: block; font-size: 0.7em; color: #666;
    text-transform: uppercase; margin-bottom: 4px; letter-spacing: 1px;
}

.popup-text {
    color: #ddd; font-size: 0.9em; word-wrap: break-word; line-height: 1.4;
}

/* --- THE WIRE (FEED) --- */
.wire-feed-container {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    padding-bottom: 80px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.wire-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid #333;
    padding: 15px;
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    position: relative;
}

#wire-view {
    width: 100%;
    height: 100%;
    border: none; /* Kein eigener Rahmen, da die Spalten die Rahmen geben */
    background-color: var(--bg-color);
}

/* 1. HEADER (Name | ID | Time) */
.wire-header {
    display: flex;
    align-items: baseline;
    gap: 10px;
    margin-bottom: 6px;
    font-size: 0.9em;
}
.wire-name { font-weight: bold; color: #fff; }
.wire-id { color: #666; }
.wire-id.offline { color: #ff3333; } /* Disconnected Style */
.wire-time { color: #555; font-size: 0.8em; margin-left: auto; }

/* 2. TAGS */
.wire-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-bottom: 8px;
    max-height: 1.5em; /* Nur eine Zeile */
    overflow: hidden;
}
.wire-tag {
    color: var(--accent-color);
    font-size: 0.85em;
    font-weight: bold;
}

/* CONTENT BODY - DYNAMIC HEIGHT */
.wire-body {
    color: #ccc;
    font-size: 1em;
    line-height: 1.5em;

    /* FIX: Keine feste Höhe, sondern eine Obergrenze! */
    max-height: 4.5em;
    /* Das erlaubt kurzen Texten, kleiner zu sein. */

    overflow: hidden;

    /* Clamp Logic für die "..." Punkte */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;

    margin-bottom: 8px;
    padding: 0 !important;
    text-indent: 0 !important;
    white-space: pre-wrap;
    word-wrap: break-word;
    border-left: 2px solid transparent;
    cursor: default;

    /* WICHTIG: Wir animieren jetzt max-height */
    transition: max-height 0.5s cubic-bezier(0.25, 1, 0.5, 1);
}

/* Wenn ausgeklappt: Block-Display erzwingen, damit line-clamp ausgeht */
.wire-body.expanded {
    display: block !important;
    -webkit-line-clamp: unset !important;
    /* max-height wird hier vom JS inline gesetzt, deshalb leer lassen */
}

/* ZEILE 2: Der Drawer (Intern) */
.sub-nav-drawer {
    width: 100%;
    display: flex;
    justify-content: center;

    /* Start: Zu */
    max-height: 0;
    opacity: 0;
    overflow: hidden;

    /* Animation */
    transition:
            max-height 0.4s cubic-bezier(0.25, 1, 0.5, 1),
            opacity 0.3s ease;
}

/* Offener Zustand */
.sub-nav-drawer.visible {
    max-height: 50px; /* Platz für den Button */
    opacity: 1;
    margin-bottom: 10px; /* Etwas Luft nach unten im Container */
}

/* Der Button Style (bleibt gleich) */
.drawer-btn {
    width: 90%;
    padding: 6px 0;
    background: rgba(0, 255, 0, 0.05);
    border: 1px solid var(--accent-color);
    color: var(--accent-color);
    font-size: 0.85em;
    font-weight: bold;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s;
}
.drawer-btn:hover {
    background: var(--accent-color);
    color: #000;
}

/* Button Styling (näher dran) */
.wire-show-more {
    color: var(--accent-color);
    font-size: 0.85em;
    cursor: pointer;
    margin-top: -4px;  /* Zieht den Button etwas höher zum Text */
    margin-bottom: 10px;
    display: none;
}
.wire-show-more:hover { text-decoration: underline; }

/* 4. FOOTER (Icons) */
.wire-footer {
    display: flex;
    align-items: center;
    gap: 25px;
    border-top: 1px solid rgba(255,255,255,0.1);
    padding-top: 10px;
    color: #888;
    font-size: 0.9em;
}

.wire-action {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    transition: color 0.2s;
}
.wire-action:hover { color: #fff; }
.wire-action.fueled { color: #ffcc00; }

/* --- COMMENTS OVERLAY (Der "Thread" View) --- */
#wire-comments-view {
    display: none;
    flex-direction: column;
    flex: 1;
    background: var(--bg-color);
}
.comments-header {
    padding: 15px;
    border-bottom: 1px solid #333;
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--panel-bg);
}
.comments-list {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}
.comment-item {
    border-bottom: 1px solid #333;
    padding: 10px 0;
    margin-bottom: 10px;
}
.comment-meta { font-size: 0.8em; color: #666; margin-bottom: 4px; }
.comment-text { color: #ccc; white-space: pre-wrap; }

.comments-input-area {
    padding: 15px;
    border-top: 1px solid #333;
    background: var(--panel-bg);
    display: flex;
    gap: 10px;
}
.comments-input {
    flex: 1;
    background: #000;
    border: 1px solid #444;
    color: #fff;
    padding: 10px;
    font-family: inherit;
}

/* --- WIRE COMPOSE DRAWER (Slide-Up) --- */

#wire-compose-drawer {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 50%; /* Nimmt die halbe Höhe ein */
    background-color: rgba(18, 18, 18, 0.95); /* Fast undurchsichtiges Schwarz */
    backdrop-filter: blur(10px); /* Blur-Effekt für den Hintergrund */
    border-top: 1px solid var(--accent-color);
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.8);
    z-index: 50; /* Über dem Feed, aber unter Popups */

    display: flex;
    flex-direction: column;

    /* Animation Setup */
    transform: translateY(105%); /* Start: Versteckt unter dem Rand */
    transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); /* Sehr smoother Slide */
}

/* Klasse zum Anzeigen */
#wire-compose-drawer.open {
    transform: translateY(0); /* Fährt hoch */
}

/* 1. TAGS AREA (Oben) */
.drawer-header {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    border-bottom: 1px solid #333;
    background: rgba(255,255,255,0.02);
}

.drawer-input-tags {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--accent-color);
    font-family: inherit;
    font-weight: bold;
    font-size: 0.9em;
    outline: none;
    text-transform: uppercase;
}
.drawer-input-tags::placeholder { color: #555; font-weight: normal; }

.close-drawer-btn {
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    font-size: 1.2em;
    padding: 0 10px;
    transition: color 0.2s;
}
.close-drawer-btn:hover { color: #fff; }

/* 2. TEXT AREA (Mitte - Füllt den Platz) */
.drawer-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 15px;
}

.drawer-textarea {
    flex: 1;
    width: 100%;
    background: transparent;
    border: none;
    color: #e0e0e0;
    font-family: inherit;
    font-size: 1.1em;
    line-height: 1.5;
    resize: none; /* User darf Größe nicht ändern */
    outline: none;
}

/* 3. TOOLBAR (Unten) */
.drawer-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    border-top: 1px solid #333;
    background: rgba(0,0,0,0.3);
}

.drawer-tools {
    display: flex;
    align-items: center;
    gap: 15px;
}

.tool-btn {
    background: transparent;
    border: 1px solid #444;
    color: #888;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85em;
    transition: all 0.2s;
}
.tool-btn:hover {
    border-color: #fff;
    color: #fff;
    background: rgba(255,255,255,0.05);
}

.char-counter {
    font-size: 0.75em;
    color: #555;
    font-family: monospace;
}

/* --- WIRE MEDIA (Bilder & Videos) --- */

.wire-media-container {
    margin-top: 10px;
    margin-bottom: 5px;

    /* Hintergrund weg oder dunkel, falls das Bild Transparenz hat */
    background: transparent;

    /* WICHTIG: Begrenzte Breite! */
    max-width: 40%; /* Bild nimmt nur noch 40% der Post-Breite ein */

    /* Optional: Mindestbreite für Mobile, damit es dort nicht zu klein wird */
    min-width: 250px;

    border-radius: 8px;
    border: 1px solid #333;
    overflow: hidden;
}

.wire-media-img {
    display: block;
    width: 100%;       /* Füllt den 40%-Container aus */
    height: auto;      /* Behält das Seitenverhältnis bei (nichts wird verzerrt) */
    max-height: 250px;
    object-fit: contain;

    cursor: zoom-in; /* Zeigt an, dass man es vergrößern kann */
    background-color: #000; /* Hintergrund für Hochkant-Bilder */
}

/* Video soll sich genau so verhalten */
.wire-media-video {
    width: 100%;
    height: auto;
    max-height: 250px;
    background: #000;
    display: block;
}

/* Mobile Optimierung: Auf Handys darf das Bild breiter sein */
@media (max-width: 700px) {
    .wire-media-container {
        max-width: 100%; /* Auf kleinen Screens volle Breite nutzen */
    }
}

/* --- FILE DOWNLOAD LINK (Compact & Minimalist) --- */
.wire-file-link {
    display: flex;
    align-items: center;

    /* WICHTIG: Box schrumpft auf Inhaltsgröße */
    width: fit-content;
    max-width: 100%; /* Aber niemals breiter als der Post */

    background: rgba(255, 255, 255, 0.03);
    border: 1px solid #333;

    padding: 6px 12px; /* Rechts etwas mehr Luft für die Optik */
    margin-top: 8px;
    margin-bottom: 2px;
    border-radius: 6px;

    cursor: pointer;
    transition: all 0.2s ease;
}

/* Hover Effekt bleibt gleich */
.wire-file-link:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: #555;
}

/* Der Rest bleibt auch gleich */
.file-icon {
    font-size: 1.2em;
    margin-right: 10px;
    color: var(--accent-color);
    flex-shrink: 0; /* Icon darf nicht gequetscht werden */
}

.file-info {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    justify-content: center;
    min-width: 0; /* Wichtig für Flexbox Text-Overflow */
}

.file-name {
    color: #ddd;
    font-weight: 500;
    font-size: 0.9em;
    font-family: inherit;

    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.file-meta {
    color: #666;
    font-size: 0.7em;
    margin-top: 1px;
    font-family: monospace;
}

/* 1. CONTROL DECK (Die Basis) */
.control-deck {
    display: flex;
    flex-direction: column; /* WICHTIG: Untereinander anordnen */

    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid #333; /* Die Border ist jetzt immer am Container */

    flex-shrink: 0;
    transition: all 0.3s ease; /* Optional: Smooth Border Movement */
}

/* Neue Hilfs-Klasse: Wenn Schublade offen ist, Border weg! */
.control-deck.merged {
    border-bottom-color: transparent; /* Macht die Linie unsichtbar */
}

/* ZEILE 1: Die Icons */
.deck-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    padding: 10px 5px; /* Padding liegt jetzt hier */
    width: 100%;
}

.control-btn {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #333;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1.2em;
    transition: all 0.2s;
    background: rgba(255, 255, 255, 0.05);
}

.control-btn:hover {
    border-color: #666;
    background: rgba(255, 255, 255, 0.1);
}

.control-btn.active {
    border-color: var(--accent-color);
    color: var(--accent-color);
    background: rgba(0, 255, 0, 0.1);
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.1);
}

/* --- CONTROL DECK ADDONS --- */

/* Der vertikale Trennstrich */
.deck-separator {
    width: 1px;
    height: 30px; /* Etwas kleiner als die Buttons */
    background-color: #444;
    margin: 5px 8px; /* Abstand links/rechts */
}

/* Der "Broadcast" Button (Hervorgehoben) */
.control-btn.action-btn {
    border-color: var(--accent-color);
    color: var(--accent-color);
    font-weight: bold;
    font-size: 1.4em; /* Größeres Plus-Zeichen */
    background: rgba(0, 255, 0, 0.05);
}

.control-btn.action-btn:hover {
    background: var(--accent-color);
    color: #000; /* Schwarz auf Grün beim Hover */
    box-shadow: 0 0 15px var(--accent-color); /* Neon Glow */
}

/* 2. INFO STREAM (Mitte, füllt den Rest) */
.info-stream-wrapper {
    flex: 1; /* Nimmt den restlichen Platz ein! */
    display: flex;
    flex-direction: column;
    overflow: hidden;
    min-height: 0; /* Flexbox Hack für Scrolling */
}

.stream-tabs {
    display: flex;
    border-bottom: 1px solid #333;
    background: rgba(0,0,0,0.2);
}

.stream-tab {
    flex: 1;
    text-align: center;
    padding: 8px 0;
    font-size: 0.8em;
    font-weight: bold;
    cursor: pointer;
    color: #666;
    border-bottom: 2px solid transparent;
}

.stream-tab:hover { color: #aaa; }

.stream-tab.active {
    color: var(--accent-color);
    border-bottom: 2px solid var(--accent-color);
    background: rgba(0,255,0,0.05);
}

.info-stream-content {
    flex: 1;
    overflow-y: auto; /* Hier wird gescrollt */
    padding: 10px;
}

/* Styling für News Items im Stream */
.stream-news-item {
    padding: 8px;
    border-left: 2px solid #444;
    margin-bottom: 10px;
    background: rgba(255,255,255,0.02);
    cursor: pointer;
    transition: border-color 0.2s;
}
.stream-news-item:hover { border-left-color: var(--accent-color); }
.stream-news-date { font-size: 0.7em; color: #666; display: block; margin-bottom: 2px; }
.stream-news-title { font-size: 0.9em; color: #ddd; font-weight: bold; }

/* 3. VOICE MODULE (Unten angedockt) */
#voice-module {
    flex-shrink: 0;
    background: #050505;
    border-top: 1px solid var(--accent-color);
    padding: 15px;

    /* Animation Setup */
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateY(0); /* Sichtbar */
}

/* Versteckter Zustand (nach unten geschoben) */
#voice-module.voice-panel-hidden {
    transform: translateY(100%);
    height: 0;
    padding: 0;
    border: none;
    overflow: hidden;
}

/* Alte Voice Styles anpassen/behalten */
.voice-header {
    font-size: 0.8em;
    color: var(--accent-color);
    margin-bottom: 10px;
    display: flex;
    align-items: center;
}
.voice-status-led { margin-right: 5px; animation: blink 2s infinite; }