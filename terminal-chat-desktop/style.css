/* --- MODERN TERMINAL THEME --- */
@import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap');

:root {
    /* Modernes Farbschema */
    --bg-color: #1a1a1a;           /* Elegantes Anthrazit */
    --panel-bg: #222222;           /* Etwas helleres Grau für Sidebars */
    --text-main: #e0e0e0;          /* Fast Weiß für Text */
    --text-muted: #888888;         /* Grau für Infos */
    --accent-color: #4af626;       /* Dein Grün */
    --accent-dim: rgba(74, 246, 38, 0.15);

    /* Rahmen */
    --border-color: rgba(255, 255, 255, 0.12);
    --border-thick: 1px solid var(--border-color);

    --font-stack: 'Fira Code', 'Courier New', monospace;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    scrollbar-width: thin;
    scrollbar-color: #444 var(--bg-color);
}

html, body {
    height: 100%;
    width: 100%;
    background-color: var(--bg-color);
    color: var(--text-main);
    font-family: var(--font-stack);
    font-size: 14px;
    display: flex;
    flex-direction: column;
    overflow: hidden; /* WICHTIG: Kein Scrollen am Hauptfenster */
}

/* --- HEADER --- */
.top-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
    background-color: var(--bg-color);
    color: var(--text-muted);
    font-weight: 500;
    border-bottom: var(--border-thick);
    flex-shrink: 0; /* Header darf nicht schrumpfen */
    text-transform: uppercase;
    letter-spacing: 2px;
    font-size: 0.9em;
    height: 50px; /* Feste Höhe für saubere Berechnung */
}

/* ==========================================================================
   MAIN LAYOUT (FLEXBOX statt GRID für Resizing)
   ========================================================================== */
.main-grid {
    display: flex;          /* Flexbox aktiviert */
    flex-direction: row;    /* Elemente nebeneinander */
    flex-grow: 1;           /* Füllt den Rest des Bildschirms unter dem Header */
    width: 100%;
    overflow: hidden;       /* Verhindert Scrollbars am Container */
}

/* --- LINKE SPALTE (SIDEBAR) --- */
.sidebar-col {
    /* Flex Eigenschaften für Resizing */
    width: 260px;           /* Startbreite */
    min-width: 180px;       /* Nicht schmaler als das */
    max-width: 500px;       /* Nicht breiter als das */
    flex-shrink: 0;         /* Darf nicht automatisch kleiner werden */

    display: flex;
    flex-direction: column;
    border-right: var(--border-thick);
    background-color: var(--panel-bg);
    overflow: hidden;
}

/* --- MITTLERE SPALTE (TERMINAL) --- */
.terminal-col {
    /* Nimmt den gesamten verfügbaren Rest-Platz */
    flex-grow: 1;
    min-width: 400px;       /* Damit der Chat nicht komplett zerdrückt wird */

    display: flex;
    flex-direction: column;
    border-right: var(--border-thick); /* Trennlinie rechts */
    height: 100%;
    position: relative;
    overflow: hidden;
    background-color: var(--bg-color);
}

/* --- RECHTE SPALTE (PANELS) --- */
.side-col {
    /* Flex Eigenschaften für Resizing */
    width: 320px;           /* Startbreite (etwas breiter als links) */
    min-width: 200px;
    max-width: 600px;
    flex-shrink: 0;

    display: flex;          /* Flexbox für vertikale Aufteilung (Promo / Voice) */
    flex-direction: column;
    height: 100%;
    overflow: hidden;
    background-color: var(--panel-bg);
}

/* --- DIE "GRIFFE" (RESIZER) --- */
/* Vertikaler Resizer (Links & Rechts vom Chat) */
.resizer {
    width: 4px;             /* Breite des Griffs */
    cursor: col-resize;     /* Mauszeiger wird zum Pfeil <-> */
    background-color: transparent; /* Unsichtbar im Normalzustand */
    transition: background-color 0.2s;
    z-index: 100;
    margin-left: -2px;      /* Zentriert über dem Border */
    margin-right: -2px;
}

/* Wenn man drüber fährt oder zieht: Leuchtet grün */
.resizer:hover, .resizer.resizing {
    background-color: var(--accent-color);
}

/* Horizontaler Resizer (In der rechten Spalte) */
.resizer-horizontal {
    height: 4px;
    cursor: row-resize;     /* Mauszeiger oben/unten */
    background-color: transparent;
    width: 100%;
    border-top: 1px solid rgba(255,255,255,0.05); /* Dezente Linie */
    border-bottom: 1px solid rgba(255,255,255,0.05);
    flex-shrink: 0;
}
.resizer-horizontal:hover {
    background-color: var(--accent-color);
}

/* ==========================================================================
   CONTENT STYLES (Design bleibt gleich)
   ========================================================================== */

#chat-list {
    flex: 1;
    overflow-y: auto;
    padding: 10px 0;
}

.chat-item {
    padding: 10px 20px;
    cursor: pointer;
    color: var(--text-muted);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 3px solid transparent;
    transition: all 0.2s;
}

.chat-item:hover {
    background-color: rgba(255, 255, 255, 0.03);
    color: var(--text-main);
}

.chat-item.active {
    background-color: var(--accent-dim);
    color: var(--accent-color);
    border-left: 3px solid var(--accent-color);
    font-weight: bold;
}

.unread-badge {
    background: var(--accent-color);
    color: #000;
    padding: 2px 6px;
    font-size: 0.75em;
    border-radius: 4px;
    font-weight: bold;
    display: none;
}
.unread-badge.visible { display: inline-block; }

/* Voice Panel unten rechts */
/* WICHTIG: Das untere Panel muss flexibel sein für den Resizer */
#info-window {
    flex-shrink: 0; /* Feste Höhe, aber änderbar via JS */
    min-height: 150px;
    display: flex;
    flex-direction: column;
}

#voice-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    text-align: center;
    padding: 10px;
}

#voice-status {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 20px;
    width: 100%;
    text-align: center;
    font-weight: bold;
    letter-spacing: 1px;
}

#voice-status.active { color: #4af626; text-shadow: 0 0 5px rgba(74, 246, 38, 0.5); }
#voice-status.alert { color: #ff3333; animation: blink 1s infinite; }

.voice-visualizer {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    height: 60px;
    gap: 4px;
    margin-bottom: 20px;
    width: calc(100% - 30px);
    margin-left: 15px;
    margin-right: 15px;
    opacity: 0.2;
    transition: opacity 0.3s;
}

.voice-visualizer.active { opacity: 1; }

.bar {
    flex: 1;
    background-color: #4af626;
    height: 3px;
    transition: height 0.05s ease;
    max-width: 15px;
}

#voice-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    width: 100%;
}

/* TERMINAL OUTPUT */
#output {
    flex: 1;
    overflow-y: auto;
    padding: 25px;
    padding-bottom: 10px;
    font-size: 1.05em;
    line-height: 1.6;
}

.line { margin-bottom: 6px; word-wrap: break-word; }
.system-msg { color: var(--text-muted); }
.error-msg { color: #ff5555; }
.my-msg { color: #fff; }
.partner-msg { color: #ccc; }
.dynamic-name { font-weight: bold; color: var(--accent-color); cursor: pointer; }

/* --- INPUT BEREICH (FIXED LAYOUT) --- */
.input-area {
    display: flex;
    align-items: flex-end;
    background: var(--panel-bg);
    padding: 15px 25px;
    border-top: var(--border-thick);
    flex-shrink: 0;
    position: relative; /* Anker für Autocomplete */
    min-height: 60px;
}

/* 1. Der Wrapper hält Prompt und Input nebeneinander */
.input-wrapper {
    position: relative;
    flex-grow: 1;
    display: flex;       /* WICHTIG: Flexbox für Nebeneinander */
    align-items: flex-start; /* Oben bündig ausrichten */
    width: 100%;
}

#prompt {
    color: var(--accent-color);
    margin-right: 12px;
    font-weight: bold;
    user-select: none;
    flex-shrink: 0;      /* Prompt darf nicht gequetscht werden */
    padding-top: 0;      /* Exakt auf Höhe der ersten Zeile */
    line-height: 1.5;    /* Gleiche Line-Height wie Input */
}

/* 2. Der Container stapelt Textarea und Mirror übereinander */
.input-container {
    flex-grow: 1;
    display: grid;       /* WICHTIG: Grid zum Stapeln */
    position: relative;
}

#command-input, #cmd-mirror {
    /* Beide Elemente liegen in derselben Grid-Zelle */
    grid-area: 1 / 1;

    width: 100%;
    font-family: inherit;
    font-size: 1.1em;
    line-height: 1.5;    /* Muss identisch zum Prompt sein */
    padding: 0;
    margin: 0;
    border: none;
    background: transparent;

    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: break-word;

    max-height: 200px;
}

#command-input {
    z-index: 2;
    color: transparent; /* Text unsichtbar für Custom Caret Effekt */
    caret-color: transparent; /* Standard Cursor weg */
    outline: none;
    resize: none;
    overflow-y: auto;
}

/* Scrollbar für Input */
#command-input::-webkit-scrollbar { width: 4px; }
#command-input::-webkit-scrollbar-thumb { background: var(--accent-color); border-radius: 2px; }

#cmd-mirror {
    z-index: 1;
    color: var(--text-main);
    pointer-events: none;
    overflow: hidden;
    min-height: 1.5em; /* Damit die Zeile auch leer eine Höhe hat */
}

/* Platzhalter Style */
#command-input::placeholder {
    opacity: 0.4;
    font-style: italic;
    color: var(--text-muted);
}

#command-input:focus::selection { background: rgba(74, 246, 38, 0.3); color: transparent; }

.cursor-block {
    display: inline-block;
    min-width: 0.6em;
    white-space: pre-wrap;
    animation: blink 1s step-end infinite;
    background-color: var(--accent-color);
    color: #000;
}

/* PANELS */
.panel-window {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border-bottom: var(--border-thick);
}
/* Das obere Panel muss flexibel sein, um den Platz zu füllen */
#panel-top {
    flex: 1;
    min-height: 100px; /* Mindesthöhe */
}

.panel-header {
    padding: 10px 15px;
    border-bottom: var(--border-thick);
    color: var(--text-muted);
    font-size: 0.8em;
    text-transform: uppercase;
    letter-spacing: 1px;
    background: var(--bg-color);
    flex-shrink: 0; /* Header darf nicht schrumpfen */
}

.panel-content, #promo-list {
    padding: 15px;
    overflow-y: auto;
    flex: 1;
}

/* Promo Cards */
.promo-card {
    border: 1px solid var(--border-color);
    padding: 12px;
    margin-bottom: 10px;
    background: rgba(255,255,255,0.02);
    transition: all 0.2s;
    cursor: pointer;
}
.promo-card:hover {
    border-color: var(--accent-color);
    background: rgba(74, 246, 38, 0.05);
}
.promo-title { font-weight: bold; color: var(--text-main); font-size: 1.1em; }
.promo-meta { font-size: 0.85em; color: var(--text-muted); margin-top: 4px; }
.promo-desc { color: var(--accent-color); font-size: 0.9em; margin: 8px 0; font-style: italic; opacity: 0.8; }

/* Buttons */
.voice-btn {
    background: transparent;
    border: 1px solid var(--border-color);
    color: var(--text-main);
    padding: 6px 12px;
    cursor: pointer;
    font-family: inherit; font-size: 0.9em;
    margin: 5px;
    border-radius: 4px;
    transition: all 0.2s;
}
.voice-btn:hover { border-color: var(--accent-color); color: var(--accent-color); }

/* Scrollbars */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-color); }
::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #666; }

/* ANIMATIONEN */
@keyframes blink {
    0%, 100% { background-color: var(--accent-color); color: #000; box-shadow: 0 0 5px var(--accent-dim); }
    50% { background-color: transparent; color: var(--text-main); box-shadow: none; }
}

/* DRAG & DROP OVERLAY */
#drop-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85); z-index: 100;
    display: none; justify-content: center; align-items: center;
    pointer-events: none;
}
#drop-overlay.active { display: flex; }
.drop-box {
    border: 2px dashed var(--accent-color);
    padding: 40px; color: var(--accent-color);
    font-size: 1.5em; background: rgba(0,0,0,0.8);
}

/* MOBILE */
@media (max-width: 900px) {
    .main-grid {
        flex-direction: column;
    }
    .sidebar-col, .side-col, .resizer, .resizer-horizontal {
        display: none;
    }
}

/* BLOG ITEMS */
.blog-entry-item {
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 12px 15px;
    margin-bottom: 8px;
    background: rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
}
.blog-entry-item:hover {
    border-color: var(--accent-color);
    background: rgba(74, 246, 38, 0.1);
    padding-left: 20px;
}
.blog-entry-item.important { border-color: #ff3333; color: #ffcccc; }
.blog-list-row { display: flex; width: 100%; align-items: center; }
.blog-list-icon { font-size: 1.2em; margin-right: 15px; }
.blog-list-title { flex-grow: 1; font-weight: bold; font-size: 1.1em; text-transform: uppercase; }
.blog-list-date { font-size: 0.8em; color: #666; font-family: monospace; }
.blog-title-large { font-size: 2em; color: var(--accent-color); margin: 10px 0 30px 0; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 15px; }
.blog-content.full-content { font-size: 1.1em; line-height: 1.8; color: var(--text-main); white-space: pre-wrap; }
.terminal-input { width: 100%; background: #111; border: 1px solid #444; color: var(--accent-color); padding: 10px; margin-bottom: 15px; font-family: inherit; font-size: 1em; }
.terminal-input:focus { border-color: var(--accent-color); outline: none; }
#unlock-pass { background: #000; border: 1px solid #ff3333; color: #ff3333; font-weight: bold; letter-spacing: 2px; }
#unlock-pass:focus { box-shadow: 0 0 10px rgba(255, 51, 51, 0.5); outline: none; }

/* SIDEBAR SEARCH */
.sidebar-search-wrapper { padding: 10px; border-bottom: 1px solid var(--border-color); background: rgba(0,0,0,0.2); }
#chat-search-input { width: 100%; background: transparent; border: 1px solid var(--border-color); color: var(--accent-color); font-family: inherit; font-size: 0.9em; padding: 5px 8px; outline: none; }
#chat-search-input:focus { border-color: var(--accent-color); background: rgba(74, 246, 38, 0.05); }

/* CHAT CATEGORIES */
.chat-category-header { padding: 15px 15px 5px 15px; font-size: 0.7em; color: #666; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid rgba(255,255,255,0.05); margin-bottom: 5px; }

/* STATE CLASSES */
.prompt-default { color: var(--accent-color) !important; opacity: 1; }
.prompt-error { color: #ff3333 !important; }
.prompt-warn { color: #ffff00 !important; }
.prompt-hidden { opacity: 0 !important; }
.input-locked { border-bottom: 1px solid #ff3333 !important; color: #ff3333 !important; pointer-events: none; }
.input-hidden { visibility: hidden; }
.promo-item { margin-bottom: 10px; border-bottom: 1px dashed #333; padding-bottom: 5px; cursor: pointer; transition: background 0.2s; }
.promo-item:hover { background: rgba(255, 255, 255, 0.05); }
.promo-name { color: #fff; font-weight: bold; }
.promo-desc { color: #888; font-size: 0.8em; margin-top: 2px; }
.promo-meta { color: #444; font-size: 0.7em; margin-top: 2px; }
.broadcast-box { border: 2px solid #f00; background: rgba(255, 0, 0, 0.1); padding: 15px; margin: 10px 0; }
.broadcast-title { color: #f00; font-weight: bold; font-size: 1.1em; margin-bottom: 8px; text-align: center; }
.broadcast-text { color: #fff; font-size: 1.1em; text-align: center; }
.broadcast-footer { text-align: right; font-size: 0.8em; color: #f00; margin-top: 10px; }
.group-broadcast-box { border: 2px solid #0f0; background: rgba(0, 255, 0, 0.1); padding: 10px; margin: 5px 0; }
.group-broadcast-header { color: #0f0; font-weight: bold; margin-bottom: 5px; }
.group-broadcast-text { color: #fff; font-style: italic; }
.group-broadcast-footer { text-align: right; font-size: 0.8em; color: #0f0; margin-top: 5px; }
.dynamic-name-admin { cursor: pointer; border-bottom: 1px dotted #555; }

/* AUTOCOMPLETE POPUP (Clean Grey Style) */
.autocomplete-items {
    position: absolute;
    bottom: 100%;
    left: 0;
    right: 0;
    background-color: var(--panel-bg);
    border-top: 1px solid #444;
    border-bottom: none;
    z-index: 9999;
    max-height: 300px;
    overflow-y: auto;
    display: none;
    box-shadow: 0 -10px 10px rgba(0, 0, 0, 0.05);
}
.autocomplete-items::-webkit-scrollbar { width: 6px; }
.autocomplete-items::-webkit-scrollbar-track { background: var(--panel-bg); }
.autocomplete-items::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
.autocomplete-items div {
    padding: 10px 20px;
    cursor: pointer;
    background-color: var(--panel-bg);
    border-bottom: 1px solid #333;
    color: #ccc;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
    display: flex;
    justify-content: space-between;
    transition: background-color 0.1s;
}
.autocomplete-items div:last-child { border-bottom: none; }
.autocomplete-items div:hover, .autocomplete-active {
    background-color: var(--bg-color) !important;
    color: #fff !important;
    border-left: 3px solid #666;
    padding-left: 17px; /* Ausgleich padding 20 - border 3 = 17 */
}
.cmd-desc { color: #666; font-style: italic; font-size: 0.85em; }
.autocomplete-active .cmd-desc { color: #999; }